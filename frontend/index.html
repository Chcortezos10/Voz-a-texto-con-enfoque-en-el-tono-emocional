<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voz-a-Texto Emocional V5 - Dashboard Pro</title>
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="brand">Transcriptor Emocional Pro V5</div>
        <div id="apiStatus" class="status-badge">Conectando...</div>
    </header>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div style="font-size: 1.2rem; font-weight: 600; margin-top: 1rem;">Procesando...</div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('analyze')">Análisis</button>
            <button class="tab" onclick="switchTab('history')">Historial</button>
            <button class="tab" onclick="switchTab('settings')">Configuración</button>
        </div>

        <!-- TAB: ANÁLISIS -->
        <div id="tab-analyze" class="tab-content active">
            <!-- Upload Section -->
            <div class="upload-section" id="uploadArea">
                <div style="font-size: 4rem;"></div>
                <h2>Arrastra tu archivo de audio aquí</h2>
                <p style="color: var(--text-muted); margin-top: 0.5rem;">
                    O haz clic para seleccionar un archivo
                </p>
                <div id="fileName" style="color: var(--primary); margin-top: 1rem;"></div>
                <input type="file" id="fileInput" hidden accept="audio/*,video/*" />
            </div>

            <!-- Configuration Panel -->
            <div class="config-panel">
                <!-- Model Selection -->
                <div class="config-card">
                    <h3>Modelo de Transcripción</h3>
                    <div class="model-selector">
                        <div class="model-option active" data-model="local">
                            <strong>Local</strong><br>
                            <small>Whisper Local</small>
                        </div>
                        <div class="model-option" data-model="cloud">
                            <strong>Cloud</strong><br>
                            <small>OpenAI API (Rápido)</small>
                        </div>
                    </div>
                    <div id="apiKeySection" style="display: none; margin-top: 1rem;">
                        <input type="password" id="openaiApiKey" placeholder="sk-..." 
                               style="width: 100%; padding: 0.75rem; background: var(--surface-hover); border: 1px solid var(--border); border-radius: 8px; color: var(--text-main);" />
                    </div>
                </div>

                <!-- Diarization -->
                <div class="config-card">
                    <h3>Diarización</h3>
                    <div class="toggle-container">
                        <span>Activar detección de hablantes</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableDiarization" checked />
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div>
                        <label>Nº Hablantes: <span id="numSpeakersValue">Auto</span></label>
                        <input type="range" id="numSpeakers" min="0" max="10" value="0" />
                    </div>
                </div>

                <!-- Emotion Analysis -->
                <div class="config-card">
                    <h3>Análisis Emocional</h3>
                    <div class="toggle-container">
                        <span>Modo Lite (solo texto)</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="liteMode" />
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div>
                        <label>Peso Audio: <span id="audioWeightValue">40%</span></label>
                        <input type="range" id="audioWeight" min="0" max="100" value="40" />
                    </div>
                </div>
            </div>

            <!-- Analyze Button -->
            <button class="btn btn-primary" id="analyzeBtn" style="width: 100%; padding: 1.2rem; font-size: 1.1rem;">
             Iniciar Análisis
            </button>

            <!-- Results Section -->
            <div id="resultsSection" style="display: none; margin-top: 3rem;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                    <h2>Resultados</h2>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="exportData('json')">
                            <i class="fas fa-file-code"></i> JSON
                        </button>
                        <button class="btn btn-secondary" onclick="exportData('csv')">
                            <i class="fas fa-file-csv"></i> CSV
                        </button>
                        <button class="btn btn-secondary" onclick="exportData('srt')">
                            <i class="fas fa-closed-captioning"></i> SRT
                        </button>
                        <button class="btn btn-secondary" onclick="exportData('txt')">
                            <i class="fas fa-file-alt"></i> TXT
                        </button>
                        <button class="btn btn-secondary" onclick="transcriptEditor.enableEditMode()">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                    </div>
                </div>

                <!-- Metrics -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="metricEmotion">-</div>
                        <div class="metric-label">Emoción Dominante</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="metricIntensity">-</div>
                        <div class="metric-label">Intensidad</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="metricSpeakers">-</div>
                        <div class="metric-label">Hablantes</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="metricDuration">-</div>
                        <div class="metric-label">Duración</div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-grid">
                    <div class="chart-container">
                        <h3>Timeline de Emociones</h3>
                        <canvas id="timelineChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Distribución</h3>
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>

                <!-- Advanced Charts -->
                <div class="charts-grid" style="margin-top: 2rem;">
                    <div class="chart-container">
                        <h3>Intensidad Emocional</h3>
                        <canvas id="intensityChart"></canvas>
                        <button class="btn btn-secondary btn-sm" style="margin-top: 1rem;" 
                                onclick="advancedCharts.exportChart('intensityChart', 'intensidad')">
                            <i class="fas fa-download"></i> Exportar Gráfico
                        </button>
                    </div>
                    <div class="chart-container">
                        <h3>Comparación por Hablante</h3>
                        <canvas id="speakerChart"></canvas>
                        <button class="btn btn-secondary btn-sm" style="margin-top: 1rem;" 
                                onclick="advancedCharts.exportChart('speakerChart', 'hablantes')">
                            <i class="fas fa-download"></i> Exportar Gráfico
                        </button>
                    </div>
                </div>

                <!-- Transcript -->
                <div class="chart-container" style="margin-top: 2rem;">
                    <h3>Transcripción</h3>
                    <div class="transcript-box" id="transcriptBox"></div>
                </div>
            </div>
        </div>

        <!-- TAB: HISTORIAL -->
        <div id="tab-history" class="tab-content">
            <div style="display: flex; justify-content: space-between; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                <h2>Historial de Análisis</h2>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-primary" onclick="statsManager.generateDashboard()">
                        <i class="fas fa-chart-line"></i> Estadísticas
                    </button>
                    <button class="btn btn-secondary" onclick="loadHistory()">
                        <i class="fas fa-sync"></i> Actualizar
                    </button>
                </div>
            </div>
            <div class="history-grid" id="historyGrid">
                <p style="text-align: center; color: var(--text-muted); padding: 3rem;">
                    No hay transcripciones guardadas
                </p>
            </div>
        </div>

        <!-- TAB: CONFIGURACIÓN -->
        <div id="tab-settings" class="tab-content">
            <h2>Configuración</h2>
            <div class="config-panel">
                <div class="config-card">
                    <h3>API Keys</h3>
                    <label>OpenAI API Key:</label>
                    <input type="password" id="settingsApiKey" 
                           style="width: 100%; padding: 0.75rem; background: var(--surface-hover); border: 1px solid var(--border); border-radius: 8px; color: var(--text-main); margin: 0.5rem 0;" 
                           placeholder="sk-..." />
                    <button class="btn btn-primary" onclick="saveApiKey()">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                </div>
                
                <div class="config-card">
                    <h3>Datos</h3>
                    <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
                        Eliminar todo el historial de análisis guardado
                    </p>
                    <button class="btn btn-secondary" onclick="clearHistory()">
                        <i class="fas fa-trash"></i> Borrar Historial
                    </button>
                </div>

                <div class="config-card">
                    <h3>Información</h3>
                    <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.5rem;">
                        <strong>Versión:</strong> 5.0.0
                    </p>
                    <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.5rem;">
                        <strong>Backend:</strong> <span id="backendUrl">http://127.0.0.1:8000</span>
                    </p>
                    <p style="color: var(--text-muted); font-size: 0.9rem;">
                        <strong>Estado:</strong> <span id="connectionStatus">Conectando...</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="js/config.js"></script>
    <script src="js/core.js"></script>
    <script src="js/theme-manager.js"></script>
    <script src="js/toast-notifications.js"></script>
    <script src="js/progress-bar.js"></script>
    <script src="js/advanced-charts.js"></script>
    <script src="js/audio-player.js"></script>
    <script src="js/search-filters.js"></script>
    <script src="js/transcript-editor.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/main.js"></script>

    <script>
        // Actualizar URL del backend en configuración
        document.addEventListener('DOMContentLoaded', () => {
            const backendUrlEl = document.getElementById('backendUrl');
            if (backendUrlEl) backendUrlEl.textContent = CONFIG.API_URL;
        });

        // Actualizar estado de conexión
        setInterval(() => {
            const statusEl = document.getElementById('connectionStatus');
            const apiStatusEl = document.getElementById('apiStatus');
            if (statusEl && apiStatusEl) {
                statusEl.textContent = apiStatusEl.classList.contains('online') ? 'Conectado ✅' : 'Desconectado ❌';
            }
        }, 1000);
    </script>
</body>
</html>
